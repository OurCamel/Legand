<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kuwait XI â€“ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</title>

<style>
:root{
  --bg:#1c2245;
  --pitch:#e4bd79;
  --lines:#1c2245;
}

body{
  margin:0;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:10px;
  font-family:'Tahoma',sans-serif;
}

.canvas{
  width:390px;
  height:844px;
  background:var(--bg);
  position:relative;
  border-radius:16px;
  overflow:hidden;
  direction:rtl;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
.title{
  position:absolute;
  top:8px;
  width:100%;
  text-align:center;
  font-size:16px;
  font-weight:700;
  color:var(--pitch);
  z-index:5;
}

/* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø·Ø© */
.formation-select{
  position:absolute;
  top:32px;
  left:16px;
  z-index:6;
}
.formation-select select{
  padding:6px 12px;
  border-radius:8px;
  border:none;
  font-size:12px;
  font-weight:700;
  background:var(--pitch);
  color:var(--lines);
  box-shadow:0 0 6px #00000040;
}

/* Ø²Ø± Ø§Ù„Ø­ÙØ¸ */
#saveLineupBtn{
  position:absolute;
  top:32px;
  right:16px;
  padding:6px 12px;
  background:var(--pitch);
  color:var(--lines);
  border:none;
  border-radius:8px;
  font-weight:bold;
  font-size:11px;
  box-shadow:0 0 6px #00000040;
  cursor:pointer;
}

/* Ø§Ù„Ù„ÙˆØ¬Ùˆ */
.logo{
  position:absolute;
  top:60px;
  width:100%;
  text-align:center;
  z-index:5;
}
.logo img{
  height:40px;
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ù„Ø¹Ø¨ */
.pitch-wrapper{
  position:absolute;
  top:100px;
  left:20px;
  right:20px;
  height:460px;
  border-radius:14px;
  overflow:hidden;
}
.pitch-wrapper svg{
  width:100%;
  height:100%;
  display:block;
}

/* Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ */
.spot-ring{
  fill:var(--pitch);
  stroke:var(--lines);
  stroke-width:4;
  filter:url(#shadow);
}
.spot.selected .spot-ring{
  stroke:#ffffff;
}
.spot-name{
  fill:var(--pitch);
  font-size:10px;
  font-weight:bold;
  text-anchor:middle;
}

/* -------- Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… -------- */

.selectors{
  position:absolute;
  bottom:12px;
  left:20px;
  right:20px;
  z-index:15;

  display:grid;
  grid-template-columns:1fr 1fr;
  column-gap:14px;
  row-gap:14px;

  padding:6px;

  background:var(--bg);
  border-radius:12px;
  box-sizing:border-box;

  height:220px;
}

.selector-box{
  background:var(--pitch);
  border-radius:14px;
  padding:10px;
  box-shadow:0 3px 10px rgba(0,0,0,0.4);

  display:flex;
  flex-direction:column;
  gap:8px;

  overflow:hidden;
}

.selector-header{
  font-size:14px;
  font-weight:800;
  text-align:center;
  color:var(--lines);
  margin-bottom:4px;
}

.players-list{
  flex:1;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.players-list button{
  border:none;
  border-radius:10px;
  padding:6px;
  font-size:12px;

  display:flex;
  align-items:center;
  gap:8px;

  background:var(--lines);
  color:var(--pitch);
  cursor:pointer;
}

.players-list button img{
  width:28px;
  height:28px;
  border-radius:50%;
  object-fit:cover;
}

/* Ø§Ù„ØªÙ„Ù…ÙŠØ­ */
.hint{
  position:absolute;
  top:570px;
  right:20px;
  left:20px;
  font-size:11px;
  text-align:center;
  color:var(--pitch);
  opacity:0.85;
}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="firebase-init.js"></script>
</head>

<body>

<div class="canvas">

  <div class="title">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ù„Ù…Ù†ØªØ®Ø¨ Ø§Ù„ÙƒÙˆÙŠØª</div>

  <div class="logo">
    <img src="https://i.postimg.cc/pdy9nJdV/IMG-1720.png" alt="OUR CAMEL">
  </div>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø·Ø© -->
  <div class="formation-select">
    <select id="formationSelect">
      <option value="4-4-2">4-4-2</option>
      <option value="4-3-3">4-3-3</option>
      <option value="4-2-3-1">4-2-3-1</option>
    </select>
  </div>

  <!-- Ø²Ø± Ø­ÙØ¸ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¹Ø±Ø¶ -->
  <button id="saveLineupBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</button>

  <!-- Ø§Ù„Ù…Ù„Ø¹Ø¨ -->
  <div class="pitch-wrapper">
    <svg viewBox="0 0 360 600" xmlns="http://www.w3.org/2000/svg">

      <defs>
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="3" stdDeviation="3" flood-color="rgba(0,0,0,0.5)"/>
        </filter>

        <!-- ClipPath Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ -->
        <clipPath id="clip0"><circle id="clipCircle0" r="30"/></clipPath>
        <clipPath id="clip1"><circle id="clipCircle1" r="30"/></clipPath>
        <clipPath id="clip2"><circle id="clipCircle2" r="30"/></clipPath>
        <clipPath id="clip3"><circle id="clipCircle3" r="30"/></clipPath>
        <clipPath id="clip4"><circle id="clipCircle4" r="30"/></clipPath>
        <clipPath id="clip5"><circle id="clipCircle5" r="30"/></clipPath>
        <clipPath id="clip6"><circle id="clipCircle6" r="30"/></clipPath>
        <clipPath id="clip7"><circle id="clipCircle7" r="30"/></clipPath>
        <clipPath id="clip8"><circle id="clipCircle8" r="30"/></clipPath>
        <clipPath id="clip9"><circle id="clipCircle9" r="30"/></clipPath>
        <clipPath id="clip10"><circle id="clipCircle10" r="30"/></clipPath>
      </defs>

            <!-- Ù…Ù„Ø¹Ø¨ OUR CAMEL â€“ ØªØ¯Ø±Ø¬ Ø£Ø²Ø±Ù‚ + Ø®Ø·ÙˆØ· Ø±Ù…Ù„ÙŠØ© -->

<defs>
  <linearGradient id="pitchGrad" gradientUnits="userSpaceOnUse"
                  x1="20" y1="60" x2="20" y2="540">
    <stop offset="0%" stop-color="#1c2245" />
    <stop offset="50%" stop-color="#262c55" />
    <stop offset="100%" stop-color="#1c2245" />
  </linearGradient>
</defs>

<!-- Ø£Ø±Ø¶ÙŠØ© Ø§Ù„Ù…Ù„Ø¹Ø¨ -->
<rect x="20" y="60" width="320" height="480" fill="url(#pitchGrad)" />

<!-- Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ù„Ø¹Ø¨ Ø¨Ù„ÙˆÙ† Ø±Ù…Ù„ÙŠ -->
<!-- Ø§Ù„Ø¥Ø·Ø§Ø± -->
<rect x="20" y="60" width="320" height="480"
      fill="none" stroke="var(--pitch)" stroke-width="3"/>

<!-- Ø®Ø· Ø§Ù„Ù…Ù†ØªØµÙ -->
<line x1="20" y1="300" x2="340" y2="300"
      stroke="var(--pitch)" stroke-width="3"/>

<!-- Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù…Ù†ØªØµÙ -->
<circle cx="180" cy="300" r="48"
        fill="none" stroke="var(--pitch)" stroke-width="3"/>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø¬Ø²Ø§Ø¡ Ø¹Ù„ÙˆÙŠØ© -->
<rect x="90" y="60" width="180" height="110"
      fill="none" stroke="var(--pitch)" stroke-width="3"/>
<rect x="130" y="60" width="100" height="60"
      fill="none" stroke="var(--pitch)" stroke-width="3"/>
<path d="M 150 170 A 30 30 0 0 0 210 170"
      fill="none" stroke="var(--pitch)" stroke-width="3"/>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø¬Ø²Ø§Ø¡ Ø³ÙÙ„ÙŠØ© -->
<rect x="90" y="430" width="180" height="110"
      fill="none" stroke="var(--pitch)" stroke-width="3"/>
<rect x="130" y="480" width="100" height="60"
      fill="none" stroke="var(--pitch)" stroke-width="3"/>
<path d="M 150 430 A 30 30 0 0 1 210 430"
      fill="none" stroke="var(--pitch)" stroke-width="3"/>

      <!-- 11 Ù…ÙˆØ¶Ø¹ Ù„Ø§Ø¹Ø¨ -->
      <g class="spot" data-index="0">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip0)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="1">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip1)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="2">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip2)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="3">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip3)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="4">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip4)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="5">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip5)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="6">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip6)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="7">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip7)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="8">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip8)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="9">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip9)"></image>
        <text class="spot-name"></text>
      </g>

      <g class="spot" data-index="10">
        <circle class="spot-ring" r="30"/>
        <image class="spot-img" width="60" height="60" clip-path="url(#clip10)"></image>
        <text class="spot-name"></text>
      </g>

    </svg>
  </div>

  <div class="hint">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø¯Ø§Ø¦Ø±Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ø¹Ø¨ØŒ Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø£Ø³ÙÙ„.</div>

  <!-- Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… -->
  <div class="selectors">
    <div class="selector-box" data-role="GK">
      <div class="selector-header">Ø­Ø§Ø±Ø³ Ù…Ø±Ù…Ù‰</div>
      <div class="players-list"></div>
    </div>
    <div class="selector-box" data-role="DEF">
      <div class="selector-header">Ù…Ø¯Ø§ÙØ¹</div>
      <div class="players-list"></div>
    </div>
    <div class="selector-box" data-role="MID">
      <div class="selector-header">ÙˆØ³Ø·</div>
      <div class="players-list"></div>
    </div>
    <div class="selector-box" data-role="ATT">
      <div class="selector-header">Ù‡Ø¬ÙˆÙ…</div>
      <div class="players-list"></div>
    </div>
  </div>

</div>

<script>
// Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„Ø¹Ø¨
const PITCH_LEFT = 40;
const PITCH_RIGHT = 320;
const PITCH_TOP = 60;
const PITCH_BOTTOM = 540;
const PITCH_WIDTH = PITCH_RIGHT - PITCH_LEFT;
const PITCH_HEIGHT = PITCH_BOTTOM - PITCH_TOP;

function mapX(p){ return PITCH_LEFT + (p/100)*PITCH_WIDTH; }
function mapY(p){ return PITCH_TOP + (p/100)*PITCH_HEIGHT; }

// Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø§Øª (Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª)
const formations = {
  "4-4-2": [
    {x:50,  y:88},   // GK Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ù„Ø¹Ø¨

    {x:25,  y:70},   // LB
    {x:40,  y:68},   // LCB
    {x:60,  y:68},   // RCB
    {x:75,  y:70},   // RB

    {x:22,  y:52},   // LM
    {x:40,  y:48},   // LCM
    {x:60,  y:48},   // RCM
    {x:78,  y:52},   // RM

    {x:42,  y:30},   // LF
    {x:58,  y:30}    // RF
  ],

  "4-3-3": [
    {x:50, y:14},
    {x:20, y:30}, {x:40, y:30}, {x:60, y:30}, {x:80, y:30},
    {x:30, y:50}, {x:50, y:48}, {x:70, y:50},
    {x:22, y:70}, {x:50, y:68}, {x:78, y:70}
  ],
  "4-2-3-1": [
    {x:50, y:14},
    {x:20, y:30}, {x:40, y:30}, {x:60, y:30}, {x:80, y:30},
    {x:42, y:44}, {x:58, y:44},
    {x:30, y:58}, {x:50, y:56}, {x:70, y:58},
    {x:50, y:72}
  ]
};

// Ø£Ø¯ÙˆØ§Ø± ÙƒÙ„ Ø¯Ø§Ø¦Ø±Ø© ÙÙŠ ÙƒÙ„ Ø®Ø·Ø©
const formationRoles = {
  "4-4-2": [
    "GK",
    "DEF","DEF","DEF","DEF",
    "MID","MID","MID","MID",
    "ATT","ATT"
  ],
  "4-3-3": [
    "GK",
    "DEF","DEF","DEF","DEF",
    "MID","MID","MID",
    "ATT","ATT","ATT"
  ],
  "4-2-3-1": [
    "GK",
    "DEF","DEF","DEF","DEF",
    "MID","MID",
    "MID","MID","MID",
    "ATT"
  ]
};

const spots = [...document.querySelectorAll('.spot')];
let selectedIndex = null;
let currentFormation = "4-4-2";

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø«Ø§Ø¨ØªØ© Ù…Ø¤Ù‚ØªØ§Ù‹ â€“ ØªÙ‚Ø¯Ø± ØªØ±Ø¨Ø·Ù‡Ø§ Ø¨ÙØ§ÙŠÙŠØ±Ø¨ÙŠØ² Ø¨Ø¹Ø¯ÙŠÙ†)
const playersData = {
  GK: [
    {name:"Ø³Ù…ÙŠØ± Ø³Ø¹ÙŠØ¯", img:"https://i.postimg.cc/c4WLD3QW/IMG_1760.png"},
    {name:"Ø§Ø­Ù…Ø¯ Ø§Ù„Ø·Ø±Ø§Ø¨Ù„Ø³ÙŠ", img:"https://i.postimg.cc/65KpHZdB/IMG_1761.png"},
    {name:"ÙÙ„Ø§Ø­ Ø¯Ø¨Ø´Ø©", img:"https://i.postimg.cc/9F2Qx9GV/IMG_1762.png"}
  ],
  DEF: [
    {name:"Ù†Ø¹ÙŠÙ… Ø³Ø¹Ø¯",   img:"https://i.postimg.cc/RVTV20Tj/IMG_1764.png"},
    {name:"Ø¹Ø§Ø¯Ù„ Ø¹Ø¨Ø§Ø³",  img:"https://i.postimg.cc/DyhwCGq2/IMG_1763.png"},
    {name:"Ù…Ø­Ø¨ÙˆØ¨ Ø¬Ù…Ø¹Ø©", img:"https://i.postimg.cc/SNGNHKGB/IMG_1765.png"},
    {name:"ÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø§Ø³Ù…",img:"https://i.postimg.cc/VLFL2NRy/IMG_1766.png"}
  ],
  MID: [
    {name:"Ø³Ø¹Ø¯ Ø§Ù„Ø­ÙˆØ·ÙŠ",     img:"https://i.postimg.cc/dt9tg0BP/IMG_1773.png"},
    {name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±Ø§Ù†",  img:"https://i.postimg.cc/15K5bzHZ/IMG_1775.png"},
    {name:"Ù†Ø§ØµØ± Ø§Ù„ØºØ§Ù†Ù…",    img:"https://i.postimg.cc/sDJDb2cr/IMG_1776.png"},
    {name:"ÙØ§Ø±ÙˆÙ‚ Ø§Ù„Ø¹ÙˆØ¶ÙŠ",   img:"https://i.postimg.cc/rF9F7pJT/IMG_1777.png"},
    {name:"ÙÙˆØ§Ø² Ø¨Ø®ÙŠØª",      img:"https://i.postimg.cc/gkKk10Dm/IMG_1778.png"}
  ],
  ATT: [
    {name:"ÙÙŠØµÙ„ Ø§Ù„Ø¯Ø®ÙŠÙ„", img:"https://i.postimg.cc/Wb7bx4nN/IMG_1780.png"},
    {name:"Ø¬Ø§Ø³Ù… ÙŠØ¹Ù‚ÙˆØ¨",  img:"https://i.postimg.cc/wTkTnBV9/IMG_1779.png"},
    {name:"Ø¹Ù„ÙŠ Ø§Ù„Ù…Ù„Ø§",   img:"https://i.postimg.cc/nc1cNLkh/IMG_1782.png"},
    {name:"Ø¨Ø´Ø§Ø± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡",img:"https://i.postimg.cc/qMGMW7LB/IMG_1781.png"},
    {name:"Ø¬Ø§Ø³Ù… Ø§Ù„Ù‡ÙˆÙŠØ¯ÙŠ",img:"https://i.postimg.cc/DycyRzgZ/IMG_1783.png"},
    {name:"Ø¨Ø¯Ø± Ø§Ù„Ù…Ø·ÙˆØ¹",  img:"https://i.postimg.cc/xTPTBdR8/IMG_1784.png"}
  ]
};

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©
function applyFormation(key){
  const f = formations[key];
  if(!f) return;
  currentFormation = key;

  f.forEach((p,i)=>{
    const cx = mapX(p.x);
    const cy = mapY(p.y);

    const g = spots[i];
    const ring = g.querySelector('.spot-ring');
    const img = g.querySelector('.spot-img');
    const nameEl = g.querySelector('.spot-name');

    ring.setAttribute('cx', cx);
    ring.setAttribute('cy', cy);

    img.setAttribute('x', cx - 30);
    img.setAttribute('y', cy - 30);

    nameEl.setAttribute('x', cx);
    nameEl.setAttribute('y', cy + 40);

    const clipCircle = document.getElementById('clipCircle' + i);
    clipCircle.setAttribute('cx', cx);
    clipCircle.setAttribute('cy', cy);
  });
}

// Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø§Ø¦Ø±Ø©
spots.forEach((g,idx)=>{
  g.addEventListener('click', ()=>{
    selectedIndex = idx;
    spots.forEach(s=>s.classList.remove('selected'));
    g.classList.add('selected');
  });
});

// Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨
function isPlayerUsed(name){
  return spots.some(s => s.querySelector('.spot-name').textContent === name);
}

// Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
document.querySelectorAll('.selector-box').forEach(box=>{
  const role = box.dataset.role;
  const listDiv = box.querySelector('.players-list');
  const list = playersData[role] || [];
  list.forEach(player=>{
    const btn = document.createElement('button');
    const img = document.createElement('img');
    img.src = player.img;
    const span = document.createElement('span');
    span.textContent = player.name;
    btn.appendChild(img);
    btn.appendChild(span);
    btn.addEventListener('click', ()=>assignPlayer(player, role));
    listDiv.appendChild(btn);
  });
});

// ØªØ¹ÙŠÙŠÙ† Ù„Ø§Ø¹Ø¨
function assignPlayer(player, role){
  if(selectedIndex === null){
    alert("Ø£ÙˆÙ„Ø§Ù‹ Ø§Ø®ØªØ± Ø¯Ø§Ø¦Ø±Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ø¹Ø¨.");
    return;
  }

  if(isPlayerUsed(player.name)){
    alert("âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
    return;
  }

  const allowedRole = formationRoles[currentFormation][selectedIndex];
  if(allowedRole !== role){
    alert("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙˆØ¶Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ² Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©.");
    return;
  }

  const spot = spots[selectedIndex];
  const imgEl = spot.querySelector('.spot-img');
  const nameEl = spot.querySelector('.spot-name');

  imgEl.setAttribute('href', player.img);
  nameEl.textContent = player.name;

  spot.classList.remove('selected');
  selectedIndex = null;
}

// ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ø·Ø©
document.getElementById('formationSelect').addEventListener('change', e=>{
  applyFormation(e.target.value);
});

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
applyFormation('4-4-2');

document.getElementById('saveLineupBtn').addEventListener('click', async ()=>{

  // Ø¬Ù…Ø¹ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©
  const lineup = [];
  let allFilled = true;

  spots.forEach((spot, i)=>{
    const name = spot.querySelector('.spot-name').textContent.trim();
    const img = spot.querySelector('.spot-img').getAttribute('href') || "";
    const role = formationRoles[currentFormation][i];
    if(!name) allFilled = false;
    lineup.push({index:i, name, img, role});
  });

  if(!allFilled){
    if(!confirm("Ù‡Ù†Ø§Ùƒ Ù…Ø±Ø§ÙƒØ² Ø¨Ø¯ÙˆÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) return;
  }

  const data = {
    formation: currentFormation,
    spots: lineup,
    createdAt: Date.now()
  };

  // Ø­ÙØ¸ Ø¯Ø§Ø®Ù„ Firebase Ø£Ùˆ LocalStorage
  if (typeof db !== "undefined"){
    try{
      await db.collection('lineups').doc('current').set(data);
    }catch(e){
      console.error(e);
      localStorage.setItem('currentLineup', JSON.stringify(data));
    }
  }else{
    localStorage.setItem('currentLineup', JSON.stringify(data));
  }

  // Ø·Ù„Ø¨ Ø­Ø³Ø§Ø¨ X
  let userX = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ X (Ø¨Ø¯ÙˆÙ† @):");
  if(!userX){
    alert("ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨!");
    return;
  }
  localStorage.setItem("userX", userX);

  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶
  window.location.href = "lineup.html";

});
</script>

</body>
</html>